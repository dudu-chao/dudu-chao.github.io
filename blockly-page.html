<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Blockly Editor</title>
  <!-- 引入 Blockly 库 -->
  <script src="https://unpkg.com/blockly/blockly.min.js"></script>
  <script src="https://unpkg.com/blockly/msg/zh-hans.js"></script>
  <style>
    html, body { height: 100%; margin: 0; }
    #blocklyDiv { width: 100%; height: 100%; }
  </style>
</head>
<body>
  <!-- Blockly 工作区容器 -->
  <div id="blocklyDiv"></div>
  <!-- 工具箱定义 -->
  <xml id="toolbox" style="display: none">
    <category name="逻辑" categorystyle="logic_category">
      <block type="controls_if"></block>
      <block type="logic_compare"></block>
      <block type="logic_operation"></block>
      <block type="logic_negate"></block>
      <block type="logic_boolean"></block>
    </category>
    <category name="循环" categorystyle="loop_category">
      <block type="controls_repeat_ext"></block>
      <block type="controls_whileUntil"></block>
    </category>
    <category name="数学" categorystyle="math_category">
      <block type="math_number"></block>
      <block type="math_arithmetic"></block>
    </category>
    <!-- 可继续添加文本、列表、变量等类别 -->
  </xml>
  <script>
    // 初始化 Blockly 工作区
    const workspace = Blockly.inject('blocklyDiv', {
      toolbox: document.getElementById('toolbox')
    });
    // 将Blockly语言默认设置为中文
    Blockly.setLocale(Blockly.ZhHans);

    // 定义一个函数获取当前工作区的JS代码，并通过postMessage发送给小程序
    function generateCode() {
      const code = Blockly.JavaScript.workspaceToCode(workspace);
      // 通过 Weixin JSBridge 接口将代码发送回小程序
      if (typeof wx !== 'undefined' && wx.miniProgram) {
        wx.miniProgram.postMessage({ data: code });
      }
      alert("生成的代码:\\n" + code);
    }
  </script>
  <!-- 添加一个按钮来生成代码 -->
  <button style="position: fixed; top: 10px; right: 10px; z-index: 999;" onclick="generateCode()">
    生成代码
  </button>
</body>
</html>
